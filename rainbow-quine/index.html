<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>rainbow quine</title>
    <link rel="stylesheet" href="./style.css">
<script src="https://public.codepenassets.com/js/prefixfree-1.0.7.min.js"></script>

  </head>
    
  <body>
  <script id=script>
  // you can adjust your screen width
  // and height until you see it all :D
  
  // and yes, this is the only js running
  
  var c = document.createElement('canvas'),
    s,
    w = c.width = window.innerWidth,
    h = c.height = window.innerHeight,
    ctx = c.getContext( '2d' ),
    opts = {
      
      hueSpeed: .2,
      interval: 60,
      waitsOnLine: 5,
      repaintAlpha: .04,
      font: '10px monospace',
      lineFont: '7px monospace',
      lineHeight: 15, //px
      lineWidth: 280
      
    },
    
    tick = 0, wait = 0,
    linesInHeight = h / opts.lineHeight,
    rainbows = [];
 
function Rainbow(){
 
  this.y = 0;
  this.wait = 0;
  this.hue = ( tick * opts.hueSpeed ) % 360;
}
Rainbow.prototype.step = function() {
  
  ++this.wait
  
  if( this.wait >= opts.waitsOnLine ){
    
    ++this.y;
    this.wait = 0;
  }
  
  ctx.fillStyle = 'hsl(hue,80%,50%)'
    .replace( 'hue', this.hue );
  
  var x = ( ( this.y / linesInHeight ) |0 )
    * opts.lineWidth,
      y = ( this.y % linesInHeight )
    * opts.lineHeight,
      l = ctx.measureText( this.y ).width;
  
  ctx.font = opts.font;
  ctx.fillText( s[ this.y ], 14 + x, y );
  
  ctx.font = opts.lineFont;
  ctx.fillText( this.y, 9 + x - l, y )
  
  if( this.y >= s.length - 1 )
    this.dead = true;
}
 
function init() {
  
  s = document.getElementById('script')
    .textContent.split( '\n' );
  ctx.font = opts.font;
  
  loop();
}
function loop() {
  
  window.requestAnimationFrame( loop );
  
  ++tick;
  ++wait;
  
  ctx.fillStyle = 'rgba(0,0,0,alp)'
    .replace( 'alp', opts.repaintAlpha );
  ctx.fillRect( 0, 0, w, h );
  
  if( wait >= opts.interval ){
    
    wait = 0;
    rainbows.push( new Rainbow );
  }
  
  for( var i = 0; i < rainbows.length; ++i ){
    
    rainbows[ i ].step();
    
    if( rainbows[ i ].dead ){
      
      rainbows.splice( i, 1 );
      --i;
    }
  }
}
 
document.body.appendChild( c );
window.addEventListener( 'DOMContentLoaded', init );
window.addEventListener( 'resize', function() {
  
  w = c.width = window.innerWidth;
  h = c.height = window.innerHeight;
                                   
  linesInHeight = h / opts.lineHeight;
  
  ctx.fillStyle = 'black';
  ctx.fillRect( 0, 0, w, h );
  ctx.font = opts.font;
});
c.addEventListener( 'click', function(){
  
  ctx.fillStyle = 'black';
  ctx.fillRect( 0, 0, w, h );
                                      
  s.reverse();
  for( var i = 0; i < s.length; ++i )
    s[ i ] = s[ i ].split('').reverse().join('');
})
// #rainbowTextWeekend by @towc
</script>
    
  </body>
  
</html>
