(function() {
  var body, boxes, browser, canvas, height, pageProxy, perspective, positionStuff, proxy, proxyHeight, setStuff, snapDuration, snapScrollTo, snapScrolling, targetBox, targetBoxIndex, transitionTimeout, width, windowHeight, windowWidth, x;

  snapDuration = 162;

  browser = $(window);

  body = $("body");

  proxy = $("#proxy");

  pageProxy = $("#pageProxy");

  canvas = $("#canvas");

  boxes = $(".box");

  windowWidth = browser.width();

  windowHeight = browser.height();

  width = body[0].scrollWidth;

  height = body[0].scrollHeight;

  perspective = windowHeight;

  proxyHeight = proxy.height();

  x = 0;

  targetBox = void 0;

  targetBoxIndex = 0;

  //if 'scrollSnapType' in document.documentElement.style || 'webkitScrollSnapType' in document.documentElement.style
  //  isScrollSnapSupported = true
  //else
  //  isScrollSnapSupported = false
  browser.on("scroll", function(event) {
    return requestAnimationFrame(positionStuff);
  });

  browser.resize(function(event) {
    setStuff();
    return requestAnimationFrame(positionStuff);
  });

  //boxes.on "click", ->
  // TODO: trigger snapScrollTo here
  transitionTimeout = null; // set later

  canvas.on("transitionEnd webkitTransitionEnd", function() {
    return canvas.css({
      "-webkit-transition": "none",
      "transition": "none"
    });
  });

  $(function() {
    setStuff();
    return requestAnimationFrame(positionStuff);
  });

  setStuff = function() {
    boxes = $(".box");
    windowWidth = browser.width();
    windowHeight = browser.height();
    width = body[0].scrollWidth;
    height = body[0].scrollHeight;
    perspective = windowHeight;
    return proxyHeight = proxy.height();
  };

  positionStuff = function() {
    var deltaX, left, leftRatio, newTargetBox, newTargetBoxIndex, newX, top, topRatio, y, z;
    left = browser.scrollLeft();
    top = browser.scrollTop();
    leftRatio = left / width;
    topRatio = top / (proxyHeight - windowHeight);
    newX = -leftRatio * width;
    deltaX = x - newX;
    x = newX;
    z = -perspective * 2.5 + topRatio * perspective * 2.5;
    if (z > 0) {
      newTargetBoxIndex = Math.round(leftRatio * boxes.length);
      newTargetBox = boxes[newTargetBoxIndex];
      if (targetBox !== newTargetBox) {
        targetBox = newTargetBox;
        pageProxy.height($(targetBox).height());
      }
      z = 0;
      y = -top + proxyHeight - windowHeight;
    } else {
      y = 0;
    }
    return canvas.css({
      "-webkit-transform": `translate3d(${x}px, ${y}px, ${z}px)`,
      "transform": `translate3d(${x}px, ${y}px, ${z}px)`
    });
  };

  snapScrollTo = function(index) {
    var deltaX, newX, transitionDuration;
    console.log("snapScrolling");
    newX = windowWidth * index;
    deltaX = Math.abs(x + newX);
    transitionDuration = deltaX / 1000;
    canvas.css({
      "-webkit-transition": `-webkit-transform ${transitionDuration}s ease-out`,
      "transition": `transform         ${transitionDuration}s ease-out`
    });
    transitionTimeout = window.setTimeout(function() {
      return canvas.css({
        "-webkit-transition": "none",
        "transition": "none"
      });
    }, transitionDuration * 1000);
    return browser.scrollLeft(newX);
  };

  snapScrolling = function() {
    var leftRatio, newTargetBoxIndex;
    leftRatio = browser.scrollLeft() / width;
    newTargetBoxIndex = Math.round(leftRatio * boxes.length);
    if (browser.scrollLeft() !== newTargetBoxIndex * windowWidth) {
      return snapScrollTo(newTargetBoxIndex);
    }
  };

  browser.on("scroll", _.debounce(snapScrolling, 100));

  browser.on("resize", _.debounce(snapScrolling, 100));

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiPGFub255bW91cz4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLElBQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQSxhQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxRQUFBLEVBQUEsWUFBQSxFQUFBLFlBQUEsRUFBQSxhQUFBLEVBQUEsU0FBQSxFQUFBLGNBQUEsRUFBQSxpQkFBQSxFQUFBLEtBQUEsRUFBQSxZQUFBLEVBQUEsV0FBQSxFQUFBOztFQUFBLFlBQUEsR0FBZTs7RUFFZixPQUFBLEdBQVUsQ0FBQSxDQUFFLE1BQUY7O0VBQ1YsSUFBQSxHQUFPLENBQUEsQ0FBRSxNQUFGOztFQUNQLEtBQUEsR0FBUSxDQUFBLENBQUUsUUFBRjs7RUFDUixTQUFBLEdBQVksQ0FBQSxDQUFFLFlBQUY7O0VBQ1osTUFBQSxHQUFTLENBQUEsQ0FBRSxTQUFGOztFQUNULEtBQUEsR0FBUSxDQUFBLENBQUUsTUFBRjs7RUFFUixXQUFBLEdBQWMsT0FBTyxDQUFDLEtBQVIsQ0FBQTs7RUFDZCxZQUFBLEdBQWUsT0FBTyxDQUFDLE1BQVIsQ0FBQTs7RUFDZixLQUFBLEdBQVEsSUFBSSxDQUFDLENBQUQsQ0FBRyxDQUFDOztFQUNoQixNQUFBLEdBQVMsSUFBSSxDQUFDLENBQUQsQ0FBRyxDQUFDOztFQUNqQixXQUFBLEdBQWM7O0VBQ2QsV0FBQSxHQUFjLEtBQUssQ0FBQyxNQUFOLENBQUE7O0VBQ2QsQ0FBQSxHQUFJOztFQUVKLFNBQUEsR0FBWTs7RUFDWixjQUFBLEdBQWlCLEVBbEJqQjs7Ozs7O0VBeUJBLE9BQU8sQ0FBQyxFQUFSLENBQVcsUUFBWCxFQUFxQixRQUFBLENBQUMsS0FBRCxDQUFBO1dBQ25CLHFCQUFBLENBQXNCLGFBQXRCO0VBRG1CLENBQXJCOztFQUdBLE9BQU8sQ0FBQyxNQUFSLENBQWUsUUFBQSxD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QUFQLENBQ0U7TUFBQSxvQkFBQSxFQUFzQixDQUFBLGtCQUFBLENBQUEsQ0FBcUIsa0JBQXJCLENBQUEsVUFBQSxDQUF0QjtNQUNBLFlBQUEsRUFBc0IsQ0FBQSxrQkFBQSxDQUFBLENBQXFCLGtCQUFyQixDQUFBLFVBQUE7SUFEdEIsQ0FERjtJQUdBLGlCQUFBLEdBQW9CLE1BQU0sQ0FBQyxVQUFQLENBQWtCLFFBQUEsQ0FBQSxDQUFBO2FBQ3BDLE1BQU0sQ0FBQyxHQUFQLENBQ0U7UUFBQSxvQkFBQSxFQUFzQixNQUF0QjtRQUNBLFlBQUEsRUFBc0I7TUFEdEIsQ0FERjtJQURvQyxDQUFsQixFQUlsQixrQkFBQSxHQUFtQixJQUpEO1dBS3BCLE9BQU8sQ0FBQyxVQUFSLENBQW1CLElBQW5CO0VBYmE7O0VBZWYsYUFBQSxHQUFnQixRQUFBLENBQUEsQ0FBQTtBQUNoQixRQUFBLFNBQUEsRUFBQTtJQUFFLFNBQUEsR0FBWSxPQUFPLENBQUMsVUFBUixDQUFBLENBQUEsR0FBdUI7SUFDbkMsaUJBQUEsR0FBb0IsSUFBSSxDQUFDLEtBQUwsQ0FBVyxTQUFBLEdBQVksS0FBSyxDQUFDLE1BQTdCO0lBQ3BCLElBQU8sT0FBTyxDQUFDLFVBQVIsQ0FBQSxDQUFBLEtBQXdCLGlCQUFBLEdBQWtCLFdBQWpEO2FBQ0UsWUFBQSxDQUFhLGlCQUFiLEVBREY7O0VBSGM7O0VBTWhCLE9BQU8sQ0FBQyxFQUFSLENBQVcsUUFBWCxFQUFxQixDQUFDLENBQUMsUUFBRixDQUFXLGFBQVgsRUFBMEIsR0FBMUIsQ0FBckI7O0VBQ0EsT0FBTyxDQUFDLEVBQVIsQ0FBVyxRQUFYLEVBQXFCLENBQUMsQ0FBQyxRQUFGLENBQVcsYUFBWCxFQUEwQixHQUExQixDQUFyQjtBQXRHQSIsInNvdXJjZXNDb250ZW50IjpbInNuYXBEdXJhdGlvbiA9IDE2MlxuXG5icm93c2VyID0gJCh3aW5kb3cpXG5ib2R5ID0gJChcImJvZHlcIilcbnByb3h5ID0gJChcIiNwcm94eVwiKVxucGFnZVByb3h5ID0gJChcIiNwYWdlUHJveHlcIilcbmNhbnZhcyA9ICQoXCIjY2FudmFzXCIpXG5ib3hlcyA9ICQoXCIuYm94XCIpXG5cbndpbmRvd1dpZHRoID0gYnJvd3Nlci53aWR0aCgpXG53aW5kb3dIZWlnaHQgPSBicm93c2VyLmhlaWdodCgpXG53aWR0aCA9IGJvZHlbMF0uc2Nyb2xsV2lkdGhcbmhlaWdodCA9IGJvZHlbMF0uc2Nyb2xsSGVpZ2h0XG5wZXJzcGVjdGl2ZSA9IHdpbmRvd0hlaWdodFxucHJveHlIZWlnaHQgPSBwcm94eS5oZWlnaHQoKVxueCA9IDBcblxudGFyZ2V0Qm94ID0gdW5kZWZpbmVkXG50YXJnZXRCb3hJbmRleCA9IDBcblxuI2lmICdzY3JvbGxTbmFwVHlwZScgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlIHx8ICd3ZWJraXRTY3JvbGxTbmFwVHlwZScgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlXG4jICBpc1Njcm9sbFNuYXBTdXBwb3J0ZWQgPSB0cnVlXG4jZWxzZVxuIyAgaXNTY3JvbGxTbmFwU3VwcG9ydGVkID0gZmFsc2VcblxuYnJvd3Nlci5vbiBcInNjcm9sbFwiLCAoZXZlbnQpIC0+XG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShwb3NpdGlvblN0dWZmKVxuXG5icm93c2VyLnJlc2l6ZSAoZXZlbnQpIC0+XG4gIHNldFN0dWZmKClcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHBvc2l0aW9uU3R1ZmYpXG5cbiNib3hlcy5vbiBcImNsaWNrXCIsIC0+XG4gICMgVE9ETzogdHJpZ2dlciBzbmFwU2Nyb2xsVG8gaGVyZVxuXG50cmFuc2l0aW9uVGltZW91dCA9IG51bGwgIyBzZXQgbGF0ZXJcbmNhbnZhcy5vbiBcInRyYW5zaXRpb25FbmQgd2Via2l0VHJhbnNpdGlvbkVuZFwiLCAtPlxuICBjYW52YXMuY3NzXG4gICAgXCItd2Via2l0LXRyYW5zaXRpb25cIjogXCJub25lXCJcbiAgICBcInRyYW5zaXRpb25cIjogICAgICAgICBcIm5vbmVcIlxuICBcbiQgLT5cbiAgc2V0U3R1ZmYoKSBcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHBvc2l0aW9uU3R1ZmYpXG4gIFxuc2V0U3R1ZmYgPSAtPlxuICBib3hlcyA9ICQoXCIuYm94XCIpXG4gIHdpbmRvd1dpZHRoID0gYnJvd3Nlci53aWR0aCgpXG4gIHdpbmRvd0hlaWdodCA9IGJyb3dzZXIuaGVpZ2h0KClcbiAgd2lkdGggPSBib2R5WzBdLnNjcm9sbFdpZHRoXG4gIGhlaWdodCA9IGJvZHlbMF0uc2Nyb2xsSGVpZ2h0XG4gIHBlcnNwZWN0aXZlID0gd2luZG93SGVpZ2h0XG4gIHByb3h5SGVpZ2h0ID0gcHJveHkuaGVpZ2h0KClcbiAgXG5wb3NpdGlvblN0dWZmID0gLT5cbiAgbGVmdCA9IGJyb3dzZXIuc2Nyb2xsTGVmdCgpXG4gIHRvcCA9IGJyb3dzZXIuc2Nyb2xsVG9wKClcbiAgbGVmdFJhdGlvID0gbGVmdCAvIHdpZHRoXG4gIHRvcFJhdGlvICA9IHRvcCAgLyAocHJveHlIZWlnaHQtd2luZG93SGVpZ2h0KVxuICBcbiAgbmV3WCA9ICgtbGVmdFJhdGlvKndpZHRoKVxuICBkZWx0YVggPSB4IC0gbmV3WFxuICB4ID0gbmV3WFxuICB6ID0gKC1wZXJzcGVjdGl2ZSoyLjUgKyB0b3BSYXRpbypwZXJzcGVjdGl2ZSoyLjUpXG4gIFxuICBpZiB6ID4gMFxuICAgIG5ld1RhcmdldEJveEluZGV4ID0gTWF0aC5yb3VuZChsZWZ0UmF0aW8gKiBib3hlcy5sZW5ndGgpXG4gICAgbmV3VGFyZ2V0Qm94ID0gYm94ZXNbbmV3VGFyZ2V0Qm94SW5kZXhdXG4gICAgdW5sZXNzIHRhcmdldEJveCA9PSBuZXdUYXJnZXRCb3hcbiAgICAgIHRhcmdldEJveCA9IG5ld1RhcmdldEJveFxuICAgICAgcGFnZVByb3h5LmhlaWdodCgkKHRhcmdldEJveCkuaGVpZ2h0KCkpXG4gICAgeiA9IDBcbiAgICB5ID0gLXRvcCArIHByb3h5SGVpZ2h0IC0gd2luZG93SGVpZ2h0XG4gIGVsc2VcbiAgICB5ID0gMFxuICAgIFxuICBjYW52YXMuY3NzXG4gICAgXCItd2Via2l0LXRyYW5zZm9ybVwiOiBcInRyYW5zbGF0ZTNkKCN7eH1weCwgI3t5fXB4LCAje3p9cHgpXCJcbiAgICBcInRyYW5zZm9ybVwiOiAgICAgICAgIFwidHJhbnNsYXRlM2QoI3t4fXB4LCAje3l9cHgsICN7en1weClcIlxuXG5zbmFwU2Nyb2xsVG8gPSAoaW5kZXgpIC0+XG4gIGNvbnNvbGUubG9nIFwic25hcFNjcm9sbGluZ1wiXG4gIG5ld1ggPSB3aW5kb3dXaWR0aCAqIGluZGV4XG4gIGRlbHRhWCA9IE1hdGguYWJzKHggKyBuZXdYKVxuICB0cmFuc2l0aW9uRHVyYXRpb24gPSBkZWx0YVggLyAxMDAwXG4gIGNhbnZhcy5jc3NcbiAgICBcIi13ZWJraXQtdHJhbnNpdGlvblwiOiBcIi13ZWJraXQtdHJhbnNmb3JtICN7dHJhbnNpdGlvbkR1cmF0aW9ufXMgZWFzZS1vdXRcIlxuICAgIFwidHJhbnNpdGlvblwiOiAgICAgICAgIFwidHJhbnNmb3JtICAgICAgICAgI3t0cmFuc2l0aW9uRHVyYXRpb259cyBlYXNlLW91dFwiXG4gIHRyYW5zaXRpb25UaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQgLT5cbiAgICBjYW52YXMuY3NzXG4gICAgICBcIi13ZWJraXQtdHJhbnNpdGlvblwiOiBcIm5vbmVcIlxuICAgICAgXCJ0cmFuc2l0aW9uXCI6ICAgICAgICAgXCJub25lXCJcbiAgLCB0cmFuc2l0aW9uRHVyYXRpb24qMTAwMFxuICBicm93c2VyLnNjcm9sbExlZnQobmV3WClcbiAgICAgIFxuc25hcFNjcm9sbGluZyA9IC0+XG4gIGxlZnRSYXRpbyA9IGJyb3dzZXIuc2Nyb2xsTGVmdCgpIC8gd2lkdGhcbiAgbmV3VGFyZ2V0Qm94SW5kZXggPSBNYXRoLnJvdW5kKGxlZnRSYXRpbyAqIGJveGVzLmxlbmd0aClcbiAgdW5sZXNzIGJyb3dzZXIuc2Nyb2xsTGVmdCgpID09IG5ld1RhcmdldEJveEluZGV4KndpbmRvd1dpZHRoXG4gICAgc25hcFNjcm9sbFRvKG5ld1RhcmdldEJveEluZGV4KVxuICAgIFxuYnJvd3Nlci5vbihcInNjcm9sbFwiLCBfLmRlYm91bmNlKHNuYXBTY3JvbGxpbmcsIDEwMCkpIFxuYnJvd3Nlci5vbihcInJlc2l6ZVwiLCBfLmRlYm91bmNlKHNuYXBTY3JvbGxpbmcsIDEwMCkpICAgICJdfQ==
//# sourceURL=coffeescript